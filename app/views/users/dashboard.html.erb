<%= render "users/balance_box" %>
<%# STATS %>
<div id="dashboard_stats_container"
    class="d-flex flex-row box-size p-0 gap-3 mb-4">

 <div id="last_month_comparison_stat"
      class="flex-fill rounded-5 shadow-sm p-3 bg-secondary">


   <div class="fw-bold">Compared to last month</div>
   <div class="fs-3 fw-bold text-primary">
      <% unless current_user.transactions.total_expenses_until_same_day_last_month == 0 %>
        <%= "#{current_user.transactions.percentage_compared_to_last_month.round(3)*100}%" %>
      <% else %>
        Not available yet
      <% end %>
   </div>
   <div>
     <% if current_user.transactions.percentage_compared_to_last_month.positive? %>
       You are spending more than last month.
     <% else %>
       Nice! You spent less.
     <% end %>
   </div>
 </div>
 <div id="daily_average_stat" class="flex-fill rounded-5 shadow-sm p-3 bg-secondary">
   <div class="fw-bold">Daily average</div>
   <div class="fs-3 fw-bold">Â¥<%= current_user.transactions.daily_average %></div>
 </div>

</div>
<%# AI CHAT FORM %>

<div id="chat_dashboard" class="box-size p-0">
  <%= simple_form_for @user_message, html: { data: {turbo: false} } do |f| %>
    <div class="position-relative my-4">
      <%= f.input :content,
            as: :string,
            placeholder: "Chat with Centi",
            required: true,
            label: false,
            input_html: { class: "form-control rounded-pill pe-5 bg-white" } %>

      <!-- Send button inside the input -->
      <%= f.button :button, class: "btn btn-success rounded-circle position-absolute top-50 translate-middle-y me-2 end-0" do %>
        <i class="fa-solid fa-arrow-up text-white"></i>
      <% end %>
    </div>
  <% end %>
</div>

<%# CREATE TRANSACTION FORM %>
<div id="create_transaction_form" class="box-size rounded-5 shadow-sm p-3 mb-4">

  <ul class="nav tabs-underlined" id="myTab" role="tablist">
    <li class="nav-item" role="presentation">
      <span class="nav-link tab-underlined active" id="bookings-tab" data-bs-toggle="tab" data-bs-target="#bookings-tab-pane" role="tab" aria-controls="bookings-tab-pane" aria-selected="true">Expense</span>
    </li>
    <li class="nav-item" role="presentation">
      <span class="nav-link tab-underlined" id="requests-tab" data-bs-toggle="tab" data-bs-target="#requests-tab-pane" role="tab" aria-controls="requests-tab-pane" aria-selected="false">Income</span>
    </li>
  </ul>
  <div class="tab-content" id="myTabContent">
    <div class="tab-pane fade py-3 show active" id="bookings-tab-pane" role="tabpanel" aria-labelledby="bookings-tab" tabindex="0">
      <%= render "partials/form", transaction: Transaction.new, categories: current_user.categories, expense: true%>
    </div>
    <div class="tab-pane fade py-3" id="requests-tab-pane" role="tabpanel" aria-labelledby="requests-tab" tabindex="0">
      <%= render "partials/form", transaction: Transaction.new, categories: current_user.categories, expense: false%>
    </div>
  </div>

</div>
